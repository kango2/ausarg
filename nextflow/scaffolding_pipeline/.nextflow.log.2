Nov-22 15:30:03.977 [main] DEBUG nextflow.cli.Launcher - $> nextflow /g/data/xl04/ka6418/github/ausarg/nextflow/scaffolding_pipeline/scaffold_jigsaw.nf --fasta /g/data/xl04/ka6418/nextflow_testing/testdata/asm.contigs.fasta --PE_1 /g/data/xl04/ka6418/nextflow_testing/testdata/fastq/HIC_R1.fastq.gz --PE_2 /g/data/xl04/ka6418/nextflow_testing/testdata/fastq/HIC_R2.fastq.gz --outputdir /g/data/xl04/ka6418/nextflow_testing/dedup/dedupp
Nov-22 15:30:04.071 [main] INFO  nextflow.cli.CmdRun - N E X T F L O W  ~  version 23.04.3
Nov-22 15:30:04.087 [main] DEBUG nextflow.plugin.PluginsFacade - Setting up plugin manager > mode=prod; embedded=false; plugins-dir=/home/150/ka6418/.nextflow/plugins; core-plugins: nf-amazon@1.16.2,nf-azure@1.0.1,nf-codecommit@0.1.4,nf-console@1.0.5,nf-ga4gh@1.0.5,nf-google@1.7.3,nf-tower@1.5.12,nf-wave@0.8.4
Nov-22 15:30:04.096 [main] INFO  org.pf4j.DefaultPluginStatusProvider - Enabled plugins: []
Nov-22 15:30:04.097 [main] INFO  org.pf4j.DefaultPluginStatusProvider - Disabled plugins: []
Nov-22 15:30:04.099 [main] INFO  org.pf4j.DefaultPluginManager - PF4J version 3.4.1 in 'deployment' mode
Nov-22 15:30:04.107 [main] INFO  org.pf4j.AbstractPluginManager - No plugins
Nov-22 15:30:04.299 [main] DEBUG nextflow.cli.CmdRun - Applied DSL=2 by global default
Nov-22 15:30:04.307 [main] INFO  nextflow.cli.CmdRun - Launching `/g/data/xl04/ka6418/github/ausarg/nextflow/scaffolding_pipeline/scaffold_jigsaw.nf` [voluminous_pesquet] DSL2 - revision: 442ac32e58
Nov-22 15:30:04.308 [main] DEBUG nextflow.plugin.PluginsFacade - Plugins default=[]
Nov-22 15:30:04.308 [main] DEBUG nextflow.plugin.PluginsFacade - Plugins resolved requirement=[]
Nov-22 15:30:04.360 [main] DEBUG nextflow.secret.LocalSecretsProvider - Secrets store: /home/150/ka6418/.nextflow/secrets/store.json
Nov-22 15:30:04.370 [main] DEBUG nextflow.secret.SecretsLoader - Discovered secrets providers: [nextflow.secret.LocalSecretsProvider@21c7208d] - activable => nextflow.secret.LocalSecretsProvider@21c7208d
Nov-22 15:30:04.447 [main] DEBUG nextflow.Session - Session UUID: be47cd28-863b-48ce-b57b-38fa2fbedb69
Nov-22 15:30:04.448 [main] DEBUG nextflow.Session - Run name: voluminous_pesquet
Nov-22 15:30:04.449 [main] DEBUG nextflow.Session - Executor pool size: 48
Nov-22 15:30:04.481 [main] DEBUG nextflow.util.ThreadPoolBuilder - Creating thread pool 'FileTransfer' minSize=10; maxSize=144; workQueue=LinkedBlockingQueue[10000]; allowCoreThreadTimeout=false
Nov-22 15:30:04.516 [main] DEBUG nextflow.cli.CmdRun - 
  Version: 23.04.3 build 5876
  Created: 18-09-2023 03:27 UTC (13:27 GMT+10:00)
  System: Linux 4.18.0-477.27.1.el8.nci.x86_64
  Runtime: Groovy 3.0.16 on OpenJDK 64-Bit Server VM 17.0.2+8-86
  Encoding: UTF-8 (UTF-8)
  Process: 1762539@gadi-login-05.gadi.nci.org.au [10.6.152.5]
  CPUs: 48 - Mem: 4 GB (928.7 MB) - Swap: 16 GB (15.2 GB)
Nov-22 15:30:04.567 [main] DEBUG nextflow.Session - Work-dir: /g/data/xl04/ka6418/github/ausarg/nextflow/scaffolding_pipeline/work [lustre]
Nov-22 15:30:04.568 [main] DEBUG nextflow.Session - Script base path does not exist or is not a directory: /g/data/xl04/ka6418/github/ausarg/nextflow/scaffolding_pipeline/bin
Nov-22 15:30:04.595 [main] DEBUG nextflow.executor.ExecutorFactory - Extension executors providers=[GoogleLifeSciencesExecutor, AwsBatchExecutor, GoogleBatchExecutor]
Nov-22 15:30:04.604 [main] DEBUG nextflow.Session - Observer factory: DefaultObserverFactory
Nov-22 15:30:04.606 [main] DEBUG nextflow.Session - Observer factory: TowerFactory
Nov-22 15:30:04.630 [main] DEBUG nextflow.cache.CacheFactory - Using Nextflow cache factory: nextflow.cache.DefaultCacheFactory
Nov-22 15:30:04.642 [main] DEBUG nextflow.util.CustomThreadPool - Creating default thread pool > poolSize: 49; maxThreads: 1000
Nov-22 15:30:04.775 [main] DEBUG nextflow.Session - Session start
Nov-22 15:30:05.339 [main] DEBUG nextflow.script.ScriptRunner - > Launching execution
Nov-22 15:30:05.390 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: pbspro
Nov-22 15:30:05.390 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'pbspro'
Nov-22 15:30:05.396 [main] DEBUG nextflow.executor.Executor - [warm up] executor > pbspro
Nov-22 15:30:05.400 [main] DEBUG n.processor.TaskPollingMonitor - Creating task monitor for executor 'pbspro' > capacity: 100; pollInterval: 5s; dumpInterval: 5m 
Nov-22 15:30:05.403 [main] DEBUG n.executor.AbstractGridExecutor - Creating executor 'pbspro' > queue-stat-interval: 1m
Nov-22 15:30:05.499 [main] DEBUG nextflow.Session - Workflow process names [dsl2]: arima_mapping
Nov-22 15:30:05.500 [main] DEBUG nextflow.Session - Igniting dataflow network (1)
Nov-22 15:30:05.500 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > arima_mapping
Nov-22 15:30:05.500 [main] DEBUG nextflow.script.ScriptRunner - > Awaiting termination 
Nov-22 15:30:05.501 [main] DEBUG nextflow.Session - Session await
Nov-22 15:30:05.699 [Task submitter] WARN  nextflow.executor.PbsProExecutor - cpus and memory directives are ignored when clusterOptions contains -l option
tip: clusterOptions = { "-l ncpus=${task.cpus},mem=${task.memory.toGiga()}G..." }
Nov-22 15:30:05.897 [Task submitter] DEBUG nextflow.executor.GridTaskHandler - [PBSPRO] submitted process arima_mapping > jobId: 102117755.gadi-pbs; workDir: /g/data/xl04/ka6418/github/ausarg/nextflow/scaffolding_pipeline/work/28/f8e8682ec42c2d8f1332f0b70b02fd
Nov-22 15:30:05.898 [Task submitter] INFO  nextflow.Session - [28/f8e868] Submitted process > arima_mapping
Nov-22 15:31:45.425 [Task monitor] DEBUG n.processor.TaskPollingMonitor - Task completed > TaskHandler[jobId: 102117755.gadi-pbs; id: 1; name: arima_mapping; status: COMPLETED; exit: 127; error: -; workDir: /g/data/xl04/ka6418/github/ausarg/nextflow/scaffolding_pipeline/work/28/f8e8682ec42c2d8f1332f0b70b02fd started: 1700631030417; exited: 2023-11-22T05:31:44Z; ]
Nov-22 15:31:45.433 [Task monitor] DEBUG nextflow.processor.TaskProcessor - Handling unexpected condition for
  task: name=arima_mapping; work-dir=/g/data/xl04/ka6418/github/ausarg/nextflow/scaffolding_pipeline/work/28/f8e8682ec42c2d8f1332f0b70b02fd
  error [nextflow.exception.ProcessFailedException]: Process `arima_mapping` terminated with an error exit status (127)
Nov-22 15:31:45.467 [Task monitor] ERROR nextflow.processor.TaskProcessor - Error executing process > 'arima_mapping'

Caused by:
  Process `arima_mapping` terminated with an error exit status (127)

Command executed:

  module load samtools parallel picard bwa
  
  
  REF=/g/data/xl04/ka6418/nextflow_testing/testdata/asm.contigs.fasta
  R1=/g/data/xl04/ka6418/nextflow_testing/testdata/fastq/HIC_R1.fastq.gz
  R2=/g/data/xl04/ka6418/nextflow_testing/testdata/fastq/HIC_R2.fastq.gz
  output=/g/data/xl04/ka6418/nextflow_testing/dedup/dedupp
  
  export JAVA_HOME=/apps/java/jdk-17.0.2/bin/java
  label=$(basename ${REF} .fasta)
  WORK_DIR=${PBS_JOBFS}
  
  cp $REF $WORK_DIR
  cd $WORK_DIR
  
  
  mkdir fastq
  ln -s ${R1} fastq/${label}_R1.fastq.gz
  ln -s ${R2} fastq/${label}_R2.fastq.gz
  
  IN_DIR=fastq
  
  
  GENOME_BASENAME=$(basename "$REF")
  REF=$WORK_DIR/$GENOME_BASENAME
  SRA=$label
  LABEL=$label
  PREFIX=$GENOME_BASENAME
  FAIDX="${GENOME_BASENAME}.fai"
  RAW_DIR="$WORK_DIR/raw"
  FILT_DIR="$WORK_DIR/filt"
  TMP_DIR="$WORK_DIR/temp"
  PAIR_DIR="$WORK_DIR/pair"
  REP_DIR="$WORK_DIR/dedup"
  MERGE_DIR="$WORK_DIR/merge"
  REP_LABEL="${LABEL}_rep1"
  FILTER="/g/data/xl04/ka6418/arima/mapping_pipeline/filter_five_end.pl"
  COMBINER="/g/data/xl04/ka6418/arima/mapping_pipeline/two_read_bam_combiner.pl"
  STATS="/g/data/xl04/ka6418/arima/mapping_pipeline/get_stats.pl"
  
  MAPQ_FILTER=10
  CPU=${PBS_NCPUS}
  
  echo "### Step 0: Check output directories' existence & create them as needed"
  [ -d $RAW_DIR ] || mkdir -p $RAW_DIR
  [ -d $FILT_DIR ] || mkdir -p $FILT_DIR
  [ -d $TMP_DIR ] || mkdir -p $TMP_DIR
  [ -d $PAIR_DIR ] || mkdir -p $PAIR_DIR
  [ -d $REP_DIR ] || mkdir -p $REP_DIR
  [ -d $MERGE_DIR ] || mkdir -p $MERGE_DIR
  
  
  if [[ -f "$REF.amb" && -f "$REF.ann" && -f "$REF.bwt" && -f "$REF.pac" && -f "$REF.sa" ]]; then
  echo "BWA index exists"
  else
      echo "BWA index does not exist, creating index..."
      bwa index -a bwtsw -p $PREFIX $REF
  fi
  
  if [[ -f "$REF.fai" ]]; then
      echo "Samtools index exists"
  else
      echo "Samtools index does not exist, creating index..."
      samtools faidx $REF
  fi
  
  HALF_CPU=$(($PBS_NCPUS / 2))
  echo $REF 
  echo $GENOME_BASENAME
  
  #Step 1: FASTQ to BAM
  echo -e "${SRA}_R1.fastq.gz\n${SRA}_R2.fastq.gz" | parallel -j 2 --eta     "bwa mem -t $HALF_CPU $REF $IN_DIR/{} | samtools view -@ $HALF_CPU -Sb - > $RAW_DIR/{/.}.bam"
  
  # Ensure the bwa mem processes have completed before moving on
  wait
  
  # Step 2: Filter 5' end
  echo -e "${SRA}_R1.fastq.bam\n${SRA}_R2.fastq.bam" | parallel -j 2 --eta     "samtools view -h $RAW_DIR/{} | perl $FILTER | samtools view -Sb - > $FILT_DIR/{}"
  
  #echo "### Step 3A: Pair reads & mapping quality filter"
  perl $COMBINER $FILT_DIR/${SRA}_R1.fastq.bam $FILT_DIR/${SRA}_R2.fastq.bam samtools $MAPQ_FILTER | samtools view -bS -t $FAIDX - | samtools sort -@ $CPU -o $TMP_DIR/$SRA.bam -
  
  #echo "### Step 3.B: Add read group"
  picard AddOrReplaceReadGroups INPUT=$TMP_DIR/$SRA.bam OUTPUT=$PAIR_DIR/$SRA.bam ID=$SRA LB=$SRA SM=$LABEL PL=ILLUMINA PU=none
  
  #echo "### Step 4: Mark duplicates"
  picard -Xmx8g MarkDuplicates INPUT=$PAIR_DIR/$SRA.bam OUTPUT=$REP_DIR/$REP_LABEL.bam METRICS_FILE=$REP_DIR/metrics.$REP_LABEL.txt TMP_DIR=$TMP_DIR ASSUME_SORTED=TRUE VALIDATION_STRINGENCY=LENIENT REMOVE_DUPLICATES=TRUE
  
  samtools index $REP_DIR/$REP_LABEL.bam
  
  cd dedup 
  cp ${label}_rep1.bam ${label}_ArimaHiC.bam 
  cp ${label}_rep1.bam.bai ${label}_ArimaHiC.bam.bai
  cp ${label}_ArimaHiC.bam ${output}
  cp ${label}_ArimaHiC.bam.bai ${output}

Command exit status:
  127

Command output:
  ### Step 0: Check output directories' existence & create them as needed
  BWA index does not exist, creating index...
  Samtools index does not exist, creating index...
  /jobfs/102117755.gadi-pbs/asm.contigs.fasta
  asm.contigs.fasta

Command error:
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 2 AVG: 0.00s  local:2/0/100%/0.0s 
  ETA: 0s Left: 1 AVG: 0.00s  local:1/1/100%/15.0s 
  ETA: 0s Left: 1 AVG: 0.00s  local:1/1/100%/15.0s 
  ETA: 1s Left: 1 AVG: 1.00s  local:1/1/100%/16.0s 
  ETA: 0s Left: 0 AVG: 0.50s  local:0/2/100%/8.0s 
  ETA: 0s Left: 0 AVG: 0.50s  local:0/2/100%/8.0s 
  [bam_sort_core] merging from 0 files and 8 in-memory blocks...
  .command.sh: line 85: picard: command not found

Work dir:
  /g/data/xl04/ka6418/github/ausarg/nextflow/scaffolding_pipeline/work/28/f8e8682ec42c2d8f1332f0b70b02fd

Tip: you can try to figure out what's wrong by changing to the process work dir and showing the script file named `.command.sh`
Nov-22 15:31:45.472 [Task monitor] DEBUG nextflow.Session - Session aborted -- Cause: Process `arima_mapping` terminated with an error exit status (127)
Nov-22 15:31:45.473 [main] DEBUG nextflow.Session - Session await > all processes finished
Nov-22 15:31:45.485 [main] DEBUG nextflow.Session - Session await > all barriers passed
Nov-22 15:31:45.497 [main] DEBUG nextflow.trace.WorkflowStatsObserver - Workflow completed > WorkflowStats[succeededCount=0; failedCount=1; ignoredCount=0; cachedCount=0; pendingCount=0; submittedCount=0; runningCount=0; retriesCount=0; abortedCount=0; succeedDuration=0ms; failedDuration=1m 15s; cachedDuration=0ms;loadCpus=0; loadMemory=0; peakRunning=1; peakCpus=1; peakMemory=0; ]
Nov-22 15:31:45.708 [main] DEBUG nextflow.cache.CacheDB - Closing CacheDB done
Nov-22 15:31:45.732 [main] DEBUG nextflow.script.ScriptRunner - > Execution complete -- Goodbye
